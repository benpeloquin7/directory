var Vote=Base.extend({_form:{},_submit:{},_archtype:{},_A:{},_B:{},_tally:{},init:function(e){this._super();this._form=$("#"+e);this._submit=this._form.find(":submit");var t=this._form.data("poll-id"),n=this._form.data("tally-a"),r=this._form.data("tally-b");this._tally={poll_id:t,tally_a:n,tally_b:r};this.createArchtype(e);this.createAB();this.animateAB();var i=this;this._submit.on("click",function(e){e.preventDefault();i.handleFormSubmit(e)});this._form.on("animateVotes",function(e){i.resetAB();var t=i;setTimeout(function(){t.createAB();t.animateAB()},700)})},handleFormSubmit:function(e){var t=this._form.serialize();console.log(t);var n=this;$.post(this._form[0].action,t,function(e){console.dir(e);if(e.response==1){var t=n._tally.poll_id;n._tally=e.tally[t];n._form.trigger("animateVotes")}},"json")},createArchtype:function(e){var t=Raphael(e,500,300);t.customAttributes.arc=function(e,t,n,r,i){var s=360/r*n,o=(90-s)*Math.PI/180,u=e+i*Math.cos(o),a=t-i*Math.sin(o),f;r==n?f=[["M",e,t-i],["A",i,i,0,1,1,e-.01,t-i]]:f=[["M",e,t-i],["A",i,i,0,+(s>180),1,u,a]];return{path:f}};t.customAttributes.reverseArc=function(e,t,n,r,i){var s=360/r*n,o=(90+s)*Math.PI/180,u=e+i*Math.cos(o),a=t-i*Math.sin(o),f;r==n?f=[["M",e,t-i],["A",i,i,0,1,1,e-.01,t-i]]:f=[["M",e,t-i],["A",i,i,0,+(s>180),0,u,a]];return{path:f}};this._archtype=t},createAB:function(){var e=this._archtype,t=23,n=this._tally.tally_a,r=this._tally.tally_b,i=e.path().attr({stroke:"#333","stroke-width":t,arc:[150,150,0,n+r,60]}),s=e.path().attr({stroke:"#f00","stroke-width":t,reverseArc:[150,150,0,n+r,60]});this._A=i;this._B=s},animateAB:function(){var e=this._A,t=this._B,n=this._tally.tally_a,r=this._tally.tally_b;e.animate({arc:[150,150,n,n+r,60]},1500,"bounce");t.animate({reverseArc:[150,150,r,n+r,60]},1500,"bounce")},resetAB:function(){var e=this._A,t=this._B,n=this._tally.tally_a,r=this._tally.tally_b;e.animate({arc:[150,150,0,n+r,60]},300,"linear");t.animate({reverseArc:[150,150,0,n+r,60]},300,"linear")}});